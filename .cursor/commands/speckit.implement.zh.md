---
description: 通过处理和执行 tasks.md 中定义的所有任务来执行实施计划。
---

## 目标

执行实施计划，通过系统地处理和执行 `tasks.md` 中定义的所有任务。

## 用户输入

```text
$ARGUMENTS
```

您**必须**在继续之前考虑用户输入（如果不为空）。

## 执行步骤

### 1. 先决条件检查

- 从仓库根目录运行 `.specify/scripts/bash/check-prerequisites.sh --json` 并解析JSON获取FEATURE_DIR和AVAILABLE_DOCS列表
- 所有文件路径必须是绝对路径
- 对于参数中的单引号如"I'm Groot"，使用转义语法：例如'I'\''m Groot'（或如果可能使用双引号："I'm Groot"）

### 2. 验证检查清单状态

检查是否存在任何未完成的检查清单项目：

1. **扫描检查清单文件**：在 `FEATURE_DIR/checklists/` 中查找所有 `.md` 文件
2. **解析未完成项目**：识别任何未选中的检查清单项目 `- [ ]`
3. **评估阻塞性**：确定未完成的项目是否会阻止实施
4. **用户提示**：如果发现关键的未完成项目，提示用户：
   ```
   发现未完成的检查清单项目：
   - [列出关键的未完成项目]
   
   这些项目可能影响实施质量。您想要：
   A) 继续实施（风险自负）
   B) 暂停并首先完成检查清单
   C) 查看详细的检查清单状态
   ```

### 3. 加载实施上下文

从FEATURE_DIR加载所有可用的设计文档：

#### 必需文档
- **tasks.md**：主要实施任务列表（如果不存在则错误退出）
- **spec.md**：功能规格和需求
- **plan.md**：技术设计和架构决策

#### 可选文档
- **data-model.md**：数据结构和关系
- **contracts/**：API合同和接口定义
- **research.md**：技术研究和决策理由
- **quickstart.md**：设置和开发指南

#### 上下文分析
对于每个加载的文档：
1. **提取关键信息**：识别实施相关的细节
2. **建立依赖关系**：理解组件之间的关系
3. **识别约束**：注意技术和业务限制
4. **收集假设**：记录任何记录的假设

### 4. 验证项目设置

检测项目技术栈并确保适当的忽略文件存在：

#### 技术栈检测
基于项目文件检测技术：
- **Node.js**: `package.json`, `yarn.lock`, `npm-shrinkwrap.json`
- **Python**: `requirements.txt`, `pyproject.toml`, `setup.py`
- **Java**: `pom.xml`, `build.gradle`, `gradle.properties`
- **Go**: `go.mod`, `go.sum`
- **Rust**: `Cargo.toml`, `Cargo.lock`
- **Docker**: `Dockerfile`, `docker-compose.yml`

#### 忽略文件管理
对于每个检测到的技术：
1. **检查现有忽略文件**：验证 `.gitignore`, `.dockerignore` 等是否存在
2. **创建缺失的忽略文件**：使用技术特定的模板
3. **更新现有文件**：添加缺失的常见忽略模式
4. **验证覆盖范围**：确保所有生成的工件都被忽略

**示例忽略模式**：
```gitignore
# Node.js
node_modules/
npm-debug.log*
.env.local

# Python
__pycache__/
*.pyc
.venv/

# Build artifacts
dist/
build/
*.log
```

### 5. 解析任务结构

分析 `tasks.md` 以理解任务组织：

#### 任务解析
1. **识别阶段**：提取主要实施阶段（设置、基础、功能、完善）
2. **解析任务项目**：识别所有任务项目及其状态
3. **建立依赖关系**：理解任务之间的依赖关系
4. **优先级排序**：确定执行顺序

#### 任务格式识别
支持多种任务格式：
```markdown
- [ ] 任务描述
- [x] 已完成的任务
- [ ] **高优先级任务**
- [ ] 任务与依赖关系 (依赖: 任务1, 任务2)
```

#### 依赖关系解析
1. **显式依赖**：在任务描述中标记的依赖关系
2. **隐式依赖**：基于任务类型和阶段的逻辑依赖关系
3. **阻塞检测**：识别可能阻止进展的循环依赖

### 6. 执行实施阶段

按阶段系统地执行任务：

#### 阶段执行策略
1. **顺序处理**：按定义的顺序处理阶段
2. **并行任务**：在可能的情况下并行执行独立任务
3. **依赖关系解析**：在执行任务之前确保满足所有依赖关系
4. **错误处理**：优雅地处理失败并提供恢复选项

#### 基于文件的协调
使用文件系统进行任务协调：
1. **任务状态跟踪**：在 `tasks.md` 中更新任务状态
2. **进度检查点**：在关键里程碑创建检查点文件
3. **错误日志**：维护详细的错误和解决方案日志
4. **回滚支持**：启用部分实施的回滚

#### TDD 原则
遵循测试驱动开发：
1. **测试优先**：在实施功能之前编写测试
2. **红-绿-重构**：遵循TDD循环
3. **覆盖率跟踪**：监控测试覆盖率指标
4. **质量门**：在继续之前确保测试通过

### 7. 进度跟踪

在整个实施过程中维护详细的进度跟踪：

#### 实时更新
1. **任务状态**：在 `tasks.md` 中将完成的任务标记为 `[x]`
2. **时间戳**：记录任务完成时间
3. **注释**：添加实施注释或偏差
4. **问题跟踪**：记录遇到的问题和解决方案

#### 进度报告
定期提供进度更新：
```markdown
## 实施进度报告

**当前阶段**: [阶段名称]
**完成的任务**: X / Y (Z%)
**预计剩余时间**: [估计]

### 最近完成
- [列出最近完成的任务]

### 当前工作
- [列出正在进行的任务]

### 下一步
- [列出即将进行的任务]

### 问题和阻塞
- [列出任何问题或阻塞]
```

### 8. 错误处理和恢复

实施强大的错误处理：

#### 错误分类
1. **语法错误**：代码编译/解析错误
2. **逻辑错误**：功能实施错误
3. **集成错误**：组件集成问题
4. **环境错误**：设置或配置问题

#### 恢复策略
1. **自动重试**：对于瞬态错误
2. **回滚**：对于破坏性更改
3. **跳过和继续**：对于非关键任务
4. **用户干预**：对于复杂问题

#### 错误文档
维护详细的错误日志：
```markdown
## 错误日志

### 错误 #001
**时间**: [时间戳]
**任务**: [任务描述]
**错误**: [错误描述]
**解决方案**: [应用的解决方案]
**状态**: [已解决/待处理/已跳过]
```

### 9. 验证和完成

在实施完成后验证结果：

#### 完成标准
1. **所有任务完成**：验证 `tasks.md` 中的所有任务都标记为完成
2. **测试通过**：确保所有测试都通过
3. **质量检查**：运行代码质量和安全扫描
4. **文档更新**：确保文档反映实施的更改

#### 最终验证
1. **功能测试**：验证所有指定的功能都正常工作
2. **集成测试**：确保组件正确集成
3. **性能测试**：验证性能要求得到满足
4. **安全审查**：检查安全漏洞

### 10. 完成报告

提供全面的实施摘要：

```markdown
## 实施完成报告

### 概述
- **开始时间**: [时间戳]
- **完成时间**: [时间戳]
- **总持续时间**: [持续时间]
- **完成的任务**: [数量]

### 实施的功能
- [列出实施的主要功能]

### 技术成就
- [列出技术里程碑]

### 质量指标
- **测试覆盖率**: [百分比]
- **代码质量评分**: [评分]
- **性能基准**: [指标]

### 遇到的问题
- [总结主要问题和解决方案]

### 偏差和决策
- [记录与原计划的任何偏差]

### 建议的后续步骤
- [建议部署、监控或进一步开发的步骤]
```

## 特殊情况处理

### 不完整的任务分解
如果 `tasks.md` 不完整或缺失关键任务：
1. **检测差距**：识别缺失的任务类别
2. **建议补充**：推荐运行 `/speckit.tasks` 来改进任务分解
3. **临时任务**：为关键缺失项目创建临时任务
4. **用户确认**：在继续之前获得用户批准

### 依赖关系冲突
当遇到依赖关系冲突时：
1. **冲突检测**：识别循环或不可能的依赖关系
2. **解决策略**：提出解决冲突的选项
3. **用户选择**：让用户选择解决方法
4. **文档更新**：更新任务以反映解决方案

### 技术栈不匹配
如果检测到的技术栈与任务不匹配：
1. **验证检测**：确认技术栈检测的准确性
2. **任务调整**：调整任务以匹配实际技术栈
3. **工具更新**：安装或配置必要的工具
4. **文档同步**：更新文档以反映实际设置

## 行为规则

1. **增量进展**：始终进行增量进展，避免大爆炸式更改
2. **质量优先**：优先考虑质量而不是速度
3. **文档同步**：保持代码和文档同步
4. **用户沟通**：定期更新用户进展和问题
5. **可恢复性**：确保实施可以从任何点恢复