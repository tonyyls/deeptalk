---
description: 执行实施规划工作流程以生成设计工件。
---

## 目标

执行实施规划工作流程，生成全面的设计工件，为功能实施做准备。

## 用户输入

```text
$ARGUMENTS
```

您**必须**在继续之前考虑用户输入（如果不为空）。

## 执行步骤

### 1. 设置

- 从仓库根目录运行 `.specify/scripts/bash/check-prerequisites.sh --json` 并解析JSON获取FEATURE_DIR和AVAILABLE_DOCS列表
- 所有文件路径必须是绝对路径
- 对于参数中的单引号如"I'm Groot"，使用转义语法：例如'I'\''m Groot'（或如果可能使用双引号："I'm Groot"）

### 2. 加载上下文

从FEATURE_DIR加载现有文档：
- **spec.md**（必需）：功能规格和需求
- **constitution.md**（如果存在）：项目章程和标准
- **任何现有的设计文档**：检查是否已存在部分设计工件

### 3. 执行规划工作流程

按顺序执行以下规划阶段：

#### A. 填充技术上下文
1. **分析规格**：提取技术要求和约束
2. **识别技术栈**：基于需求确定适当的技术
3. **架构决策**：做出关键的架构选择
4. **依赖关系映射**：识别外部依赖和集成点

#### B. 章程检查
1. **加载项目章程**：从 `.specify/constitution.md` 读取项目标准
2. **验证对齐**：确保规划决策与章程原则一致
3. **标准应用**：应用章程中定义的技术标准和约定
4. **冲突解决**：解决规格需求与章程标准之间的任何冲突

#### C. 评估门控
验证规划的先决条件：
1. **规格完整性**：确保规格足够详细以进行规划
2. **澄清状态**：检查是否存在未解决的 `[NEEDS CLARIFICATION]` 标记
3. **依赖关系可用性**：验证所需的外部依赖关系
4. **资源可行性**：评估技术和时间约束

**门控失败处理**：
- 如果发现关键问题，错误退出并提供具体的修复建议
- 建议运行适当的 speckit 命令（例如，`/speckit.clarify` 用于未解决的澄清）

#### D. 生成 research.md
创建技术研究文档：
1. **识别未知项**：列出需要研究的技术问题
2. **研究任务**：为每个未知项定义具体的研究任务
3. **优先级排序**：按影响和紧急性对研究任务进行排序
4. **时间估算**：为研究活动提供时间估算

#### E. 生成 data-model.md
设计数据模型：
1. **实体提取**：从规格中识别核心数据实体
2. **关系映射**：定义实体之间的关系
3. **属性定义**：为每个实体指定属性和约束
4. **验证规则**：定义数据验证和业务规则

#### F. 生成合同
创建API合同和接口定义：
1. **端点设计**：基于功能需求设计API端点
2. **数据格式**：定义请求和响应格式
3. **错误处理**：指定错误响应和状态码
4. **版本控制**：建立API版本控制策略

#### G. 生成 quickstart.md
创建开发设置指南：
1. **环境设置**：详细的开发环境设置说明
2. **依赖关系安装**：安装和配置步骤
3. **构建过程**：构建和运行说明
4. **测试设置**：测试环境和执行指南

### 4. 规划工作流程详细信息

#### 阶段 0：大纲和研究
**目标**：识别和解决技术未知项

**步骤**：
1. **提取未知项**：
   - 扫描规格以查找技术不确定性
   - 识别需要原型设计或概念验证的区域
   - 列出需要第三方库或服务评估的项目

2. **生成研究任务**：
   - 为每个未知项创建具体的研究任务
   - 定义成功标准和可交付成果
   - 估算研究时间和资源需求

3. **在 research.md 中合并发现**：
   - 记录研究发现和决策
   - 包括原型结果和基准测试
   - 提供技术选择的理由

#### 阶段 1：设计和合同
**目标**：创建详细的技术设计和接口

**步骤**：
1. **为 data-model.md 提取实体**：
   - 从规格和用户故事中识别核心实体
   - 定义实体属性、类型和约束
   - 建立实体关系和外键
   - 包括数据验证规则和业务逻辑

2. **生成API合同**：
   - 基于功能需求设计RESTful或GraphQL端点
   - 定义请求/响应模式和数据格式
   - 指定身份验证和授权要求
   - 包括错误处理和状态码

3. **更新代理上下文**：
   - 将设计决策集成到项目上下文中
   - 更新架构文档和决策记录
   - 确保所有工件之间的一致性

### 5. 报告

生成规划过程的摘要：

```markdown
## 规划执行报告

### 生成的工件
- **research.md**: [描述内容和关键发现]
- **data-model.md**: [总结实体和关系]
- **contracts/**: [列出生成的API合同]
- **quickstart.md**: [概述设置说明]

### 关键决策
- [列出重要的架构和技术决策]

### 识别的风险
- [列出技术风险和缓解策略]

### 下一步
- 审查生成的设计工件
- 运行 `/speckit.tasks` 生成实施任务
- 考虑运行 `/speckit.analyze` 进行质量检查
```

## 关键规则

1. **使用绝对路径**：所有文件操作必须使用绝对路径
2. **门控失败时错误退出**：如果关键先决条件未满足，不要继续
3. **未解决澄清时错误退出**：如果规格包含 `[NEEDS CLARIFICATION]` 标记，要求先解决

## 工件模板

### research.md 模板
```markdown
# 技术研究

## 研究任务

### [任务名称]
**状态**: [待处理/进行中/完成]
**优先级**: [高/中/低]
**估算时间**: [时间估算]

**问题**: [需要研究的技术问题]
**方法**: [研究方法和步骤]
**发现**: [研究结果和结论]
**决策**: [基于研究的技术决策]

## 技术选择

### [技术类别]
**选择**: [选定的技术/库/服务]
**理由**: [选择的原因]
**替代方案**: [考虑的其他选项]
**权衡**: [优缺点分析]

## 原型和概念验证

### [原型名称]
**目标**: [原型的目的]
**结果**: [原型结果和学习]
**代码**: [原型代码位置或片段]
```

### data-model.md 模板
```markdown
# 数据模型

## 实体

### [实体名称]
**描述**: [实体的目的和角色]

**属性**:
- `id`: [类型] - [描述]
- `name`: [类型] - [描述]
- `created_at`: [类型] - [描述]

**关系**:
- [关系类型] [目标实体] - [描述]

**约束**:
- [约束描述]

**验证规则**:
- [验证规则描述]

## 关系图

```
[实体关系图或描述]
```

## 数据流

### [流程名称]
1. [步骤描述]
2. [步骤描述]
```

### quickstart.md 模板
```markdown
# 快速开始指南

## 先决条件
- [列出必需的软件和版本]

## 安装

### 1. 克隆仓库
```bash
git clone [仓库URL]
cd [项目目录]
```

### 2. 安装依赖关系
```bash
[安装命令]
```

### 3. 环境设置
```bash
[环境配置命令]
```

## 开发

### 运行开发服务器
```bash
[开发服务器命令]
```

### 运行测试
```bash
[测试命令]
```

### 构建项目
```bash
[构建命令]
```

## 故障排除

### 常见问题
- **问题**: [问题描述]
  **解决方案**: [解决步骤]
```

## 错误处理

- **缺失规格**：如果 `spec.md` 不存在，错误退出并建议运行 `/speckit.specify`
- **未解决的澄清**：如果发现 `[NEEDS CLARIFICATION]` 标记，错误退出并建议运行 `/speckit.clarify`
- **章程冲突**：如果规格需求与章程标准冲突，提供解决选项
- **技术可行性**：如果技术要求不可行，提供替代建议